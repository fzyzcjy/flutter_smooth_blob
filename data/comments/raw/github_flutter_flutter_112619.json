{"source": "github", "metadata": {"org": "flutter", "repo": "flutter", "issue": 112619}, "content": {"author": {"login": "fzyzcjy"}, "body": "There are needs to simulate sync heavy work, such as a slow widget build, in flutter widget tests. This method simply expose that.\r\n\r\nAs a remark, this cannot be replaced by `runAsync`. Consider the following example:\r\n\r\n```dart\r\n    testWidgets('can use to simulate slow build', (WidgetTester tester) async {\r\n      final DateTime beforeTime = binding.clock.now();\r\n\r\n      await tester.pumpWidget(Builder(builder: (_) {\r\n        bool timerCalled = false;\r\n        Timer.run(() => timerCalled = true);\r\n\r\n        binding.elapseBlocking(const Duration(seconds: 1));\r\n\r\n        // if we use `delayed` instead of `elapseBlocking`, such as\r\n        // binding.delayed(const Duration(seconds: 1));\r\n        // the timer will be called here. Surely, that violates how\r\n        // a flutter widget build works\r\n        expect(timerCalled, false);\r\n\r\n        return Container();\r\n      }));\r\n\r\n      expect(binding.clock.now(), beforeTime.add(const Duration(seconds: 1)));\r\n      binding.idle();\r\n    });\r\n```\r\n\r\nAs is discussed in the comments in the example, if we use `delayed`, timers will be fired when executing half of a build function, which is totally wrong.\r\n\r\n*List which issues are fixed by this PR. You must list at least one issue.*\r\nClose https://github.com/flutter/flutter/issues/112620\r\n\r\n*If you had to change anything in the [flutter/tests] repo, include a link to the migration guide as per the [breaking change policy].*\r\n\r\n## Pre-launch Checklist\r\n\r\n- [x] I read the [Contributor Guide] and followed the process outlined there for submitting PRs.\r\n- [x] I read the [Tree Hygiene] wiki page, which explains my responsibilities.\r\n- [x] I read and followed the [Flutter Style Guide], including [Features we expect every widget to implement].\r\n- [x] I signed the [CLA].\r\n- [x] I listed at least one issue that this PR fixes in the description above.\r\n- [x] I updated/added relevant documentation (doc comments with `///`).\r\n- [x] I added new tests to check the change I am making, or this PR is [test-exempt].\r\n- [x] All existing and new tests are passing.\r\n\r\nIf you need help, consider asking for advice on the #hackers-new channel on [Discord].\r\n\r\n<!-- Links -->\r\n[Contributor Guide]: https://github.com/flutter/flutter/wiki/Tree-hygiene#overview\r\n[Tree Hygiene]: https://github.com/flutter/flutter/wiki/Tree-hygiene\r\n[test-exempt]: https://github.com/flutter/flutter/wiki/Tree-hygiene#tests\r\n[Flutter Style Guide]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo\r\n[Features we expect every widget to implement]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo#features-we-expect-every-widget-to-implement\r\n[CLA]: https://cla.developers.google.com/\r\n[flutter/tests]: https://github.com/flutter/tests\r\n[breaking change policy]: https://github.com/flutter/flutter/wiki/Tree-hygiene#handling-breaking-changes\r\n[Discord]: https://github.com/flutter/flutter/wiki/Chat\r\n", "comments": [], "createdAt": "2022-09-29T06:21:11Z", "title": "Export `elapseBlocking` to test binding, so slow sync work can be simulated such as a slow widget build"}}