{"source": "github", "metadata": {"org": "flutter", "repo": "flutter", "issue": 110131}, "content": {"author": {"login": "fzyzcjy"}, "body": "Close #110129\r\n\r\nPlease see the issue for paragraphs about the bug cause and fix etc\r\n\r\n*If you had to change anything in the [flutter/tests] repo, include a link to the migration guide as per the [breaking change policy].*\r\n\r\n## Pre-launch Checklist\r\n\r\n- [x] I read the [Contributor Guide] and followed the process outlined there for submitting PRs.\r\n- [x] I read the [Tree Hygiene] wiki page, which explains my responsibilities.\r\n- [x] I read and followed the [Flutter Style Guide], including [Features we expect every widget to implement].\r\n- [x] I signed the [CLA].\r\n- [x] I listed at least one issue that this PR fixes in the description above.\r\n- [x] I updated/added relevant documentation (doc comments with `///`).\r\n- [x] I added new tests to check the change I am making, or this PR is [test-exempt].\r\n- [x] All existing and new tests are passing.\r\n\r\nIf you need help, consider asking for advice on the #hackers-new channel on [Discord].\r\n\r\n<!-- Links -->\r\n[Contributor Guide]: https://github.com/flutter/flutter/wiki/Tree-hygiene#overview\r\n[Tree Hygiene]: https://github.com/flutter/flutter/wiki/Tree-hygiene\r\n[test-exempt]: https://github.com/flutter/flutter/wiki/Tree-hygiene#tests\r\n[Flutter Style Guide]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo\r\n[Features we expect every widget to implement]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo#features-we-expect-every-widget-to-implement\r\n[CLA]: https://cla.developers.google.com/\r\n[flutter/tests]: https://github.com/flutter/tests\r\n[breaking change policy]: https://github.com/flutter/flutter/wiki/Tree-hygiene#handling-breaking-changes\r\n[Discord]: https://github.com/flutter/flutter/wiki/Chat\r\n", "comments": [{"id": "IC_kwDOAeUeuM5JBU2V", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "The test, without the fix, fails. This verifies the PR is needed.\r\n\r\nhttps://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8804990179272978753/+/u/run_test.dart_for_framework_tests_shard_and_subshard_widgets/test_stdout\r\n\r\n```\r\n\u2550\u2550\u2561 EXCEPTION CAUGHT BY WIDGETS LIBRARY \u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\nThe following StateError was thrown building KeyedSubtree-[#c5088]:\r\nBad state: Cannot clone a disposed image.\r\nThe clone() method of a previously-disposed Image was called. Once an Image object has been\r\ndisposed, it can no longer be used to create handles, as the underlying data may have been released.\r\n\r\nWhen the exception was thrown, this was the stack:\r\n#0      Image.clone (dart:ui/painting.dart:1808:7)\r\n#1      RawImage.createRenderObject (package:flutter/src/widgets/basic.dart:5951:21)\r\n#2      RenderObjectElement.mount (package:flutter/src/widgets/framework.dart:5744:52)\r\n...     Normal element mounting (10 frames)\r\n#12     Element.inflateWidget (package:flutter/src/widgets/framework.dart:3883:16)\r\n#13     Element.updateChild (package:flutter/src/widgets/framework.dart:3606:20)\r\n#14     ComponentElement.performRebuild (package:flutter/src/widgets/framework.dart:4920:16)\r\n#15     StatefulElement.performRebuild (package:flutter/src/widgets/framework.dart:5060:11)\r\n#16     Element.rebuild (package:flutter/src/widgets/framework.dart:4617:5)\r\n#17     BuildOwner.buildScope (package:flutter/src/widgets/framework.dart:2687:19)\r\n#18     AutomatedTestWidgetsFlutterBinding.drawFrame (package:flutter_test/src/binding.dart:1244:19)\r\n#19     RendererBinding._handlePersistentFrameCallback (package:flutter/src/rendering/binding.dart:374:5)\r\n#20     SchedulerBinding._invokeFrameCallback (package:flutter/src/scheduler/binding.dart:1175:15)\r\n#21     SchedulerBinding.handleDrawFrame (package:flutter/src/scheduler/binding.dart:1104:9)\r\n#22     AutomatedTestWidgetsFlutterBinding.pump.<anonymous closure> (package:flutter_test/src/binding.dart:1093:9)\r\n#25     TestAsyncUtils.guard (package:flutter_test/src/test_async_utils.dart:71:41)\r\n#26     AutomatedTestWidgetsFlutterBinding.pump (package:flutter_test/src/binding.dart:1079:27)\r\n#27     WidgetTester.pump.<anonymous closure> (package:flutter_test/src/widget_tester.dart:618:53)\r\n#30     TestAsyncUtils.guard (package:flutter_test/src/test_async_utils.dart:71:41)\r\n#31     WidgetTester.pump (package:flutter_test/src/widget_tester.dart:618:27)\r\n#32     main.<anonymous closure> (file:///b/s/w/ir/x/w/flutter/packages/flutter/test/widgets/image_test.dart:83:20)\r\n<asynchronous suspension>\r\n<asynchronous suspension>\r\n(elided 5 frames from dart:async and package:stack_trace)\r\n\r\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\r\n02:21 +3329 ~2 -1: /b/s/w/ir/x/w/flutter/packages/flutter/test/widgets/image_test.dart: Verify Image does not use disposed handles [E]                                                                 \r\n  Test failed. See exception logs above.\r\n  The test description was: Verify Image does not use disposed handles\r\n  \r\n\u2550\u2550\u2561 EXCEPTION CAUGHT BY WIDGET INSPECTOR \u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n```", "createdAt": "2022-08-24T02:01:02Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/110131#issuecomment-1225084309"}, {"id": "IC_kwDOAeUeuM5JBe-V", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "All tests have passed\r\n\r\n![image](https://user-images.githubusercontent.com/5236035/186311411-4f587025-2553-4cb9-b0ef-eda7356c0c56.png)\r\n", "createdAt": "2022-08-24T03:04:53Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/110131#issuecomment-1225125781"}, {"id": "IC_kwDOAeUeuM5JHLHp", "author": {"login": "dnfield"}, "authorAssociation": "MEMBER", "body": "LGTM once tests are passing :)", "createdAt": "2022-08-25T00:07:05Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [{"content": "LAUGH", "users": {"totalCount": 1}}], "url": "https://github.com/flutter/flutter/pull/110131#issuecomment-1226617321"}, {"id": "IC_kwDOAeUeuM5JHc7P", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "@dnfield Tests are passing :)\r\n\r\n![image](https://user-images.githubusercontent.com/5236035/186558824-8864aa0c-cad7-49ba-b164-d9d02424612f.png)\r\n", "createdAt": "2022-08-25T02:16:37Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/110131#issuecomment-1226690255"}, {"id": "IC_kwDOAeUeuM5JL_k7", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "What should I do now \ud83d\udc40 ", "createdAt": "2022-08-26T00:23:22Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/110131#issuecomment-1227880763"}, {"id": "IC_kwDOAeUeuM5JMAzE", "author": {"login": "dnfield"}, "authorAssociation": "MEMBER", "body": "Sorry, thought I had added the label!", "createdAt": "2022-08-26T00:32:39Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/110131#issuecomment-1227885764"}, {"id": "IC_kwDOAeUeuM5JMA1i", "author": {"login": "auto-submit"}, "authorAssociation": "NONE", "body": "- Please get at least one approved review if you are already a member or two member reviews if you are not a member before re-applying this label. __Reviewers__: If you left a comment approving, please use the \"approve\" review action instead.", "createdAt": "2022-08-26T00:32:57Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/110131#issuecomment-1227885922"}, {"id": "IC_kwDOAeUeuM5JMA1v", "author": {"login": "auto-submit"}, "authorAssociation": "NONE", "body": "Validations Fail.", "createdAt": "2022-08-26T00:32:58Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/110131#issuecomment-1227885935"}, {"id": "IC_kwDOAeUeuM5JMBSl", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "@dnfield That's OK. Oops seems to need one more reviewer", "createdAt": "2022-08-26T00:36:33Z", "includesCreatedEdit": true, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/110131#issuecomment-1227887781"}], "createdAt": "2022-08-24T01:11:09Z", "title": "Fix Image's logical flow which disposes its image too early, causing errors such as \"Cannot clone a disposed image\""}}