{"source": "github", "metadata": {"org": "flutter", "repo": "flutter", "issue": 109287}, "content": {"author": {"login": "fzyzcjy"}, "body": "**I will start adding tests once flutter team thinks this PR is acceptable, since I am not sure whether the team like to fix it, and if the team does not like it I will not waste time on it :)**\r\n\r\n---\r\n\r\nWhen implementing `RenderBox.paint`, we know we should respect the `offset` parameter. However, even though `_paintContents` respects it, the `_paintHandleLayers` does not - instead it completely ignores the offset parameter. This is logically wrong as it does not respect the definition and requirements of the function.\r\n\r\nLuckily (or unluckily), currently it does not have *visible* harm *yet*. This is because `RenderEditable` is used by `_Editable` and future by `EditableText`. And, the `_Editable`'s ancestors widgets do not provide any offset (because the widgets in the same Layer paint child without shifting). Thus, `offset` parameter is always zero in the *current* version of Flutter.\r\n\r\nHowever, I am still proposing this PR because of the following reasons:\r\n\r\n1. It is logically wrong (violates definition of `paint`), so by definition it is a bug and we should fix it.\r\n2. It may be a visible bug in future releases. With adding more functionality to text fields, surely we cannot guarantee RenderEditable's ancestors always give a zero offset. (If we think so, I should immediately raise another PR with `assert(offset==Offset.zero)` to enforce it.)\r\n3. Users who need deep customization may directly use `RenderEditable` (since it is public), and even copy some of the source code and hack it (e.g. me). With their customizations, it is highly possible that the offset is no longer always zero, then they will find suddenly the text selections shifted weirdly. (Disclaimer: That is my case, and why I find this bug)\r\n\r\nI have not come up with a way to make tests about this, because `_Editable` is private, and as mentioned above, it is logically wrong but not visible now.\r\nHowever, this PR does not add any new logic, so making existing tests pass IMHO may be sufficient.\r\n\r\nClose #109289\r\n\r\n*If you had to change anything in the [flutter/tests] repo, include a link to the migration guide as per the [breaking change policy].*\r\n\r\nP.S. https://discord.com/channels/608014603317936148/608018585025118217/1006808038914654218\r\n\r\n## Pre-launch Checklist\r\n\r\n- [x] I read the [Contributor Guide] and followed the process outlined there for submitting PRs.\r\n- [x] I read the [Tree Hygiene] wiki page, which explains my responsibilities.\r\n- [x] I read and followed the [Flutter Style Guide], including [Features we expect every widget to implement].\r\n- [x] I signed the [CLA].\r\n- [x] I listed at least one issue that this PR fixes in the description above.\r\n- [x] I updated/added relevant documentation (doc comments with `///`).\r\n- [x] I added new tests to check the change I am making, or this PR is [test-exempt].\r\n- [x] All existing and new tests are passing.\r\n\r\nIf you need help, consider asking for advice on the #hackers-new channel on [Discord].\r\n\r\n<!-- Links -->\r\n[Contributor Guide]: https://github.com/flutter/flutter/wiki/Tree-hygiene#overview\r\n[Tree Hygiene]: https://github.com/flutter/flutter/wiki/Tree-hygiene\r\n[test-exempt]: https://github.com/flutter/flutter/wiki/Tree-hygiene#tests\r\n[Flutter Style Guide]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo\r\n[Features we expect every widget to implement]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo#features-we-expect-every-widget-to-implement\r\n[CLA]: https://cla.developers.google.com/\r\n[flutter/tests]: https://github.com/flutter/tests\r\n[breaking change policy]: https://github.com/flutter/flutter/wiki/Tree-hygiene#handling-breaking-changes\r\n[Discord]: https://github.com/flutter/flutter/wiki/Chat\r\n", "comments": [{"id": "IC_kwDOAeUeuM5IIjfA", "author": {"login": "flutter-dashboard"}, "authorAssociation": "NONE", "body": "It looks like this pull request may not have tests. Please make sure to add tests before merging. If you need [an exemption](https://github.com/flutter/flutter/wiki/Tree-hygiene#tests) to this rule, contact Hixie on the #hackers channel in [Chat](https://github.com/flutter/flutter/wiki/Chat) (don't just cc him here, he won't see it! *He's on Discord!*).\n\nIf you are not sure if you need tests, consider this rule of thumb: the purpose of a test is to make sure someone doesn't accidentally revert the fix. Ask yourself, **is there anything in your PR that you feel it is important we not accidentally revert back to how it was before your fix?**\n\n__Reviewers__: Read the [Tree Hygiene page](https://github.com/flutter/flutter/wiki/Tree-hygiene#how-to-review-code) and make sure this patch meets those guidelines before LGTMing.", "createdAt": "2022-08-10T06:06:31Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/109287#issuecomment-1210202048"}, {"id": "IC_kwDOAeUeuM5IT2Ut", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "@justinmc Hi, as discussed by @Hixie at [here](https://discord.com/channels/608014603317936148/608018585025118217/1007426425126658159):\r\n\r\n> @Hixie : seems fine to me but @Justin McCandless (justinmc) is the person we should really ask\r\n\r\nSo I wonder whether this PR is ok for you? If so I will spend time adding tests.", "createdAt": "2022-08-12T14:19:32Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/109287#issuecomment-1213162797"}, {"id": "IC_kwDOAeUeuM5IVVtL", "author": {"login": "justinmc"}, "authorAssociation": "CONTRIBUTOR", "body": "As discussed on Discord, the approach in this PR looks good to me.  Please tag me or request a review from me when you finish the tests.", "createdAt": "2022-08-12T22:06:59Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [{"content": "LAUGH", "users": {"totalCount": 1}}], "url": "https://github.com/flutter/flutter/pull/109287#issuecomment-1213553483"}, {"id": "IC_kwDOAeUeuM5IVlON", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "@justinmc New tests added and passed :)\r\n\r\n![image](https://user-images.githubusercontent.com/5236035/184461024-9bab123b-e907-44e9-856b-069ca47c47d8.png)\r\n", "createdAt": "2022-08-13T00:45:25Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/109287#issuecomment-1213617037"}, {"id": "IC_kwDOAeUeuM5IZuuv", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "@justinmc Hi, is there any updates?", "createdAt": "2022-08-15T07:28:15Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/109287#issuecomment-1214704559"}, {"id": "IC_kwDOAeUeuM5Ifflv", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "All tests have passed\r\n\r\n![image](https://user-images.githubusercontent.com/5236035/184815098-fdc30f49-58f0-4532-8771-25fc2b55b3bc.png)\r\n", "createdAt": "2022-08-16T06:47:15Z", "includesCreatedEdit": true, "isMinimized": false, "minimizedReason": "", "reactionGroups": [{"content": "HOORAY", "users": {"totalCount": 1}}], "url": "https://github.com/flutter/flutter/pull/109287#issuecomment-1216215407"}], "createdAt": "2022-08-10T05:54:50Z", "title": "Fix that RenderEditable (TextField) ignores offset in painting, making text selections shifted when offset is nonzero"}}