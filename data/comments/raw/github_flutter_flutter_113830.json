{"source": "github", "metadata": {"org": "flutter", "repo": "flutter", "issue": 113830}, "content": {"author": {"login": "fzyzcjy"}, "body": "Some tests set the time dilation to be non-one, but is not reset after the test ends. Thus, every test after it will see very weird time. I find this bug because got trapped in https://github.com/flutter/flutter/pull/113828.\r\n\r\nThe added line, `timeDilation = 1.0; // restore time dilation, or it will affect other tests`, is copied from `image_stream_test.dart`'s `'timeDilation affects animation frame timers'` test.\r\n\r\n## Pre-launch Checklist\r\n\r\n- [x] I read the [Contributor Guide] and followed the process outlined there for submitting PRs.\r\n- [x] I read the [Tree Hygiene] wiki page, which explains my responsibilities.\r\n- [x] I read and followed the [Flutter Style Guide], including [Features we expect every widget to implement].\r\n- [x] I signed the [CLA].\r\n- [x] I listed at least one issue that this PR fixes in the description above.\r\n- [x] I updated/added relevant documentation (doc comments with `///`).\r\n- [x] I added new tests to check the change I am making, or this PR is [test-exempt].\r\n- [x] All existing and new tests are passing.\r\n\r\nIf you need help, consider asking for advice on the #hackers-new channel on [Discord].\r\n\r\n<!-- Links -->\r\n[Contributor Guide]: https://github.com/flutter/flutter/wiki/Tree-hygiene#overview\r\n[Tree Hygiene]: https://github.com/flutter/flutter/wiki/Tree-hygiene\r\n[test-exempt]: https://github.com/flutter/flutter/wiki/Tree-hygiene#tests\r\n[Flutter Style Guide]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo\r\n[Features we expect every widget to implement]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo#features-we-expect-every-widget-to-implement\r\n[CLA]: https://cla.developers.google.com/\r\n[flutter/tests]: https://github.com/flutter/tests\r\n[breaking change policy]: https://github.com/flutter/flutter/wiki/Tree-hygiene#handling-breaking-changes\r\n[Discord]: https://github.com/flutter/flutter/wiki/Chat\r\n", "comments": [{"id": "IC_kwDOAeUeuM5M9iiz", "author": {"login": "goderbauer"}, "authorAssociation": "MEMBER", "body": "`TestWidgetsFlutterBinding._verifyInvariants` could be the right place to check for this.", "createdAt": "2022-10-25T22:16:37Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/113830#issuecomment-1291200691"}, {"id": "IC_kwDOAeUeuM5M9yRH", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "@Piinks Yes I think so, @goderbauer mentions the _verifyInvariants - the one I have seen a ton of times reporting I changed somthing (e.g. fake screen resolution) but do not change it back\r\n\r\nI will update soon.", "createdAt": "2022-10-26T00:03:08Z", "includesCreatedEdit": true, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/113830#issuecomment-1291265095"}, {"id": "IC_kwDOAeUeuM5M90q-", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "done\r\n\r\n/cc @Piinks @goderbauer ", "createdAt": "2022-10-26T00:21:02Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/113830#issuecomment-1291274942"}, {"id": "IC_kwDOAeUeuM5NATeA", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "CI passes", "createdAt": "2022-10-26T12:00:00Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/113830#issuecomment-1291925376"}], "createdAt": "2022-10-21T11:53:27Z", "title": "Fix bug that`timeDilation` is not reset, causing subsequent test errors, and add verifications to ensure such problem does not exist in the future"}}