{"source": "github", "metadata": {"org": "flutter", "repo": "flutter", "issue": 112437}, "content": {"author": {"login": "fzyzcjy"}, "body": "1. I will finish code details, refine code, add tests, make tests pass, etc, after a code review that thinks the *rough idea* is acceptable. It is because, from my past experience, reviews may request changing a lot. If the general idea is to be changed, all detailed implementation efforts are wasted :)\r\n2. The PR has an already-working counterpart, and it produces ~60FPS smooth experimental results. The benchmark results and detailed analysis is in chapter https://cjycode.com/flutter_smooth/benchmark/. All the source code is in  https://github.com/fzyzcjy/engine/tree/flutter-smooth and https://github.com/fzyzcjy/flutter/tree/flutter-smooth.\r\n3. Possibly useful as a context to this PR, there is a whole chapter discussing the internals - how flutter_smooth is implemented. (Link: https://cjycode.com/flutter_smooth/design/)\r\n\r\n---\r\n\r\n\r\n\r\n**Remark:** This PR has less priority compared with the other two (https://github.com/flutter/engine/pull/36438, https://github.com/flutter/flutter/pull/112436), because this one can be workaround, while the other two are really mandatory to implement PreemptBuilder.\r\n\r\n---\r\n\r\nThis PR is a part for implementing the 60fps smooth rendering (#101227).\r\n\r\nSome discussions can be seen in Discord, such as around https://discordapp.com/channels/608014603317936148/608021234516754444/1024141682377236500.\r\n\r\n*List which issues are fixed by this PR. You must list at least one issue.*\r\nhttps://github.com/flutter/flutter/issues/101227\r\n\r\n*If you had to change anything in the [flutter/tests] repo, include a link to the migration guide as per the [breaking change policy].*\r\n\r\n## Pre-launch Checklist\r\n\r\n- [x] I read the [Contributor Guide] and followed the process outlined there for submitting PRs.\r\n- [x] I read the [Tree Hygiene] wiki page, which explains my responsibilities.\r\n- [x] I read and followed the [Flutter Style Guide], including [Features we expect every widget to implement].\r\n- [x] I signed the [CLA].\r\n- [x] I listed at least one issue that this PR fixes in the description above.\r\n- [x] I updated/added relevant documentation (doc comments with `///`).\r\n- [x] I added new tests to check the change I am making, or this PR is [test-exempt].\r\n- [x] All existing and new tests are passing.\r\n\r\nIf you need help, consider asking for advice on the #hackers-new channel on [Discord].\r\n\r\n<!-- Links -->\r\n[Contributor Guide]: https://github.com/flutter/flutter/wiki/Tree-hygiene#overview\r\n[Tree Hygiene]: https://github.com/flutter/flutter/wiki/Tree-hygiene\r\n[test-exempt]: https://github.com/flutter/flutter/wiki/Tree-hygiene#tests\r\n[Flutter Style Guide]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo\r\n[Features we expect every widget to implement]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo#features-we-expect-every-widget-to-implement\r\n[CLA]: https://cla.developers.google.com/\r\n[flutter/tests]: https://github.com/flutter/tests\r\n[breaking change policy]: https://github.com/flutter/flutter/wiki/Tree-hygiene#handling-breaking-changes\r\n[Discord]: https://github.com/flutter/flutter/wiki/Chat\r\n", "comments": [{"id": "IC_kwDOAeUeuM5L6tLe", "author": {"login": "goderbauer"}, "authorAssociation": "MEMBER", "body": "This patch is missing a lot of context information. To quote Dan from the other patch:\r\n\r\n> This patch needs a lot more context.\r\n> What's the main goal you're trying to achieve with this particular change?\r\n> Why is it doing it this way?\r\n> Why can't we used existing mechanisms to achieve the same thing?\r\n> Why do we need this mechanism to achieve the larger goal of having incremental/progressive layout?\r\n\r\nRegardless, this doesn't seem like a great API to provide a single static callback that gets called on every layout. What if multiple implementations are trying to set this?\r\nAlso, this gets called for the layout of every single RenderObject. This doesn't sound great for performance. I know, the title claims it has no overhead, but I find that hard to believe. What's the basis for that claim?", "createdAt": "2022-10-10T18:35:45Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/112437#issuecomment-1273680606"}, {"id": "IC_kwDOAeUeuM5L7jhf", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "Please ignore this PR for now, since in the https://github.com/fzyzcjy/flutter_smooth (i.e. impl of https://docs.google.com/document/d/1FuNcBvAPghUyjeqQCOYxSt6lGDAQ1YxsNlOvrUx0Gko/edit#), I am trying to use manual widgets as a workaround. So skip it is you are busy :)\r\n\r\n> This doesn't sound great for performance. I know, the title claims it has no overhead, but I find that hard to believe. What's the basis for that claim?\r\n\r\nI mean zero overhead *when it is disabled* (which IIRC is what hixie(?) cares about a lot). \r\n\r\nCompiler explorer says it is zero overhead b/c the compiler just correctly understands it and eliminate the dead code: https://discord.com/channels/608014603317936148/608021234516754444/1024141725024923688", "createdAt": "2022-10-10T23:18:30Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/112437#issuecomment-1273903199"}, {"id": "IC_kwDOAeUeuM5NDE5T", "author": {"login": "goderbauer"}, "authorAssociation": "MEMBER", "body": "> Please ignore this PR for now\r\n\r\nI am going to close this then for now to get it off the queue. Feel free to reopen when you can provide more context. ", "createdAt": "2022-10-26T21:05:48Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/112437#issuecomment-1292652115"}, {"id": "IC_kwDOAeUeuM5NDgy6", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "Sure, thanks!", "createdAt": "2022-10-26T23:20:03Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/112437#issuecomment-1292766394"}], "createdAt": "2022-09-27T03:53:22Z", "title": "Exposing hook for RenderObject.layout with zero overhead"}}