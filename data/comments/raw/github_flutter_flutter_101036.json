{"source": "github", "metadata": {"org": "flutter", "repo": "flutter", "issue": 101036}, "content": {"author": {"login": "fzyzcjy"}, "body": "*Replace this paragraph with a description of what this PR is changing or adding, and why. Consider including before/after screenshots.*\r\nPlease see https://github.com/flutter/flutter/issues/100830\r\n\r\n*List which issues are fixed by this PR. You must list at least one issue.*\r\nhttps://github.com/flutter/flutter/issues/100830\r\n\r\nRelated: https://github.com/flutter/engine/pull/32334\r\n\r\n*If you had to change anything in the [flutter/tests] repo, include a link to the migration guide as per the [breaking change policy].*\r\n\r\n## Pre-launch Checklist\r\n\r\n- [x] I read the [Contributor Guide] and followed the process outlined there for submitting PRs.\r\n- [x] I read the [Tree Hygiene] wiki page, which explains my responsibilities.\r\n- [x] I read and followed the [Flutter Style Guide], including [Features we expect every widget to implement].\r\n- [x] I signed the [CLA].\r\n- [x] I listed at least one issue that this PR fixes in the description above.\r\n- [x] I updated/added relevant documentation (doc comments with `///`).\r\n- [x] I added new tests to check the change I am making, or this PR is [test-exempt].\r\n- [x] All existing and new tests are passing.\r\n\r\nIf you need help, consider asking for advice on the #hackers-new channel on [Discord].\r\n\r\n<!-- Links -->\r\n[Contributor Guide]: https://github.com/flutter/flutter/wiki/Tree-hygiene#overview\r\n[Tree Hygiene]: https://github.com/flutter/flutter/wiki/Tree-hygiene\r\n[test-exempt]: https://github.com/flutter/flutter/wiki/Tree-hygiene#tests\r\n[Flutter Style Guide]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo\r\n[Features we expect every widget to implement]: https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo#features-we-expect-every-widget-to-implement\r\n[CLA]: https://cla.developers.google.com/\r\n[flutter/tests]: https://github.com/flutter/tests\r\n[breaking change policy]: https://github.com/flutter/flutter/wiki/Tree-hygiene#handling-breaking-changes\r\n[Discord]: https://github.com/flutter/flutter/wiki/Chat\r\n", "comments": [{"id": "IC_kwDOAeUeuM5AjKI6", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "This should fail until https://github.com/flutter/engine/pull/32334 is merged and flutter/flutter repo uses the latest flutter/engine.", "createdAt": "2022-03-30T10:49:42Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1082958394"}, {"id": "IC_kwDOAeUeuM5A8pgb", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "We know dilate/erode is not implemented for the web platform, just like the compose filter. So what should I do (skip tests when in web?)?\r\n\r\n```\r\n\u2550\u2550\u2561 EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK \u255e\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\nThe following UnimplementedError was thrown running a test:\r\nImageFilter.dilate not implemented for web platform.\r\n\r\nWhen the exception was thrown, this was the stack:\r\n../dart-sdk/lib/_internal/js_dev_runtime/private/ddc_runtime/errors.dart 251:49  throw_\r\n../lib/ui/painting.dart 411:5                                                    dilate\r\nimage_filter_test.dart.js 428:133                                                <fn>\r\n../dart-sdk/lib/_internal/js_dev_runtime/patch/async_patch.dart 84:54            runBody\r\n../dart-sdk/lib/_internal/js_dev_runtime/patch/async_patch.dart 123:5            _async\r\nimage_filter_test.dart.js 427:80                                                 <fn>\r\n../packages/flutter_test/src/matchers.dart.js 4522:19                            <fn>\r\n```", "createdAt": "2022-04-06T01:43:57Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1089640475"}, {"id": "IC_kwDOAeUeuM5A8poA", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "/cc @dnfield ", "createdAt": "2022-04-06T01:44:29Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1089640960"}, {"id": "IC_kwDOAeUeuM5A9ApU", "author": {"login": "dnfield"}, "authorAssociation": "MEMBER", "body": "Skip these on web with a reference to the bug filed to implement them for web.", "createdAt": "2022-04-06T03:19:14Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1089735252"}, {"id": "IC_kwDOAeUeuM5A9JWP", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "Thanks, I will do that.", "createdAt": "2022-04-06T03:56:01Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1089770895"}, {"id": "IC_kwDOAeUeuM5BecSB", "author": {"login": "goderbauer"}, "authorAssociation": "MEMBER", "body": "@fzyzcjy Can you update the tests per the suggestion above to make the checks happy?", "createdAt": "2022-04-13T21:22:58Z", "includesCreatedEdit": true, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1098499201"}, {"id": "IC_kwDOAeUeuM5BeyR-", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "Sure. I forgot it", "createdAt": "2022-04-14T00:10:32Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1098589310"}, {"id": "IC_kwDOAeUeuM5Be4Me", "author": {"login": "flutter-dashboard"}, "authorAssociation": "NONE", "body": "Golden file changes have been found for this pull request. Click [here to view and triage](https://flutter-gold.skia.org/cl/github/101036) (e.g. because this is an intentional change).\n\nIf you are still iterating on this change and are not ready to resolve the images on the Flutter Gold dashboard, consider marking this PR as a draft pull request above. You will still be able to view image results on the dashboard, commenting will be silenced, and the check will not try to resolve itself until marked ready for review.\n\n\n\nFor more guidance, visit [Writing a golden file test for `package:flutter`](https://github.com/flutter/flutter/wiki/Writing-a-golden-file-test-for-package:flutter).\n\n__Reviewers__: Read the [Tree Hygiene page](https://github.com/flutter/flutter/wiki/Tree-hygiene#how-to-review-code) and make sure this patch meets those guidelines before LGTMing.\n\n_Changes reported for pull request #101036 at sha c39d7b80811c4903213d9559c764386ab26ada02_\n\n", "createdAt": "2022-04-14T01:07:52Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1098613534"}, {"id": "IC_kwDOAeUeuM5B1Pcw", "author": {"login": "goderbauer"}, "authorAssociation": "MEMBER", "body": "@fzyzcjy Can you take a look at the golden images linked in the previous comment to confirm that that's what you expected them to look like? One of the images looks empty, which seems odd...", "createdAt": "2022-04-20T21:34:51Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1104475952"}, {"id": "IC_kwDOAeUeuM5B1nwc", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "@goderbauer I guess it is right, just b/c it erodes too much. I have updated the test so it will be less strange.", "createdAt": "2022-04-21T00:23:06Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1104575516"}, {"id": "IC_kwDOAeUeuM5B1vHP", "author": {"login": "flutter-dashboard"}, "authorAssociation": "NONE", "body": "Golden file changes are available for triage from new commit, Click [here to view](https://flutter-gold.skia.org/cl/github/101036).\n\n\n\nFor more guidance, visit [Writing a golden file test for `package:flutter`](https://github.com/flutter/flutter/wiki/Writing-a-golden-file-test-for-package:flutter).\n\n__Reviewers__: Read the [Tree Hygiene page](https://github.com/flutter/flutter/wiki/Tree-hygiene#how-to-review-code) and make sure this patch meets those guidelines before LGTMing.\n\n_Changes reported for pull request #101036 at sha e3d3659c4911cfa6caa84c6c3e5ec0b6cf69b146_\n\n", "createdAt": "2022-04-21T01:04:39Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1104605647"}, {"id": "IC_kwDOAeUeuM5B18fs", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "The gold looks better. (Notice it has very very thin lines)", "createdAt": "2022-04-21T03:10:40Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1104660460"}, {"id": "IC_kwDOAeUeuM5B42R6", "author": {"login": "goderbauer"}, "authorAssociation": "MEMBER", "body": "Thanks, @fzyzcjy \r\n\r\n@dnfield or @flar could you review this one (and also approve the goldens) since you reviewed the upstream PR in the engine?", "createdAt": "2022-04-21T16:06:14Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1105421434"}, {"id": "IC_kwDOAeUeuM5B6r_P", "author": {"login": "flar"}, "authorAssociation": "CONTRIBUTOR", "body": "> Thanks, @fzyzcjy\r\n> \r\n> @dnfield or @flar could you review this one (and also approve the goldens) since you reviewed the upstream PR in the engine?\r\n\r\nI still don't see anything rendered in the erode test even if I click on it to see it full size. Am I clicking on the wrong link?\r\n\r\nActually, it looks like I was reviewing the goldens from before I requested a larger stroke width. Maybe they haven't been updated yet?", "createdAt": "2022-04-22T01:05:42Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1105903567"}, {"id": "IC_kwDOAeUeuM5B6se3", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "> I still don't see anything rendered in the erode test even if I click on it to see it full size. Am I clicking on the wrong link?\r\nActually, it looks like I was reviewing the goldens from before I requested a larger stroke width. Maybe they haven't been updated yet?\r\n\r\nI guess the CI is even not executed after modifying strokewidth...\r\n\r\n![image](https://user-images.githubusercontent.com/5236035/164576970-bb95b5bb-b435-43cc-85d9-262e91f03ec1.png)\r\n", "createdAt": "2022-04-22T01:09:51Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1105905591"}, {"id": "IC_kwDOAeUeuM5B6skn", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "I guess the failure (and seems skipped executing all tests related to golden) is not caused by me. So maybe need to wait", "createdAt": "2022-04-22T01:10:38Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1105905959"}, {"id": "IC_kwDOAeUeuM5B6uEd", "author": {"login": "flar"}, "authorAssociation": "CONTRIBUTOR", "body": "> I guess the failure (and seems skipped executing all tests related to golden) is not caused by me. So maybe need to wait\r\n\r\nI mentioned it on the infra Discord chat to see if someone can poke it.", "createdAt": "2022-04-22T01:24:12Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1105912093"}, {"id": "IC_kwDOAeUeuM5B6uIa", "author": {"login": "flar"}, "authorAssociation": "CONTRIBUTOR", "body": "I would just LGTM to let it merge, but I'm worried it may merge with bad goldens and cause problems down the line.", "createdAt": "2022-04-22T01:24:48Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1105912346"}, {"id": "IC_kwDOAeUeuM5B6wzc", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "Take your time. Since this is a test-only PR I am not that urgent :)", "createdAt": "2022-04-22T01:52:23Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [{"content": "THUMBS_UP", "users": {"totalCount": 1}}], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1105923292"}, {"id": "IC_kwDOAeUeuM5B-jP9", "author": {"login": "flar"}, "authorAssociation": "CONTRIBUTOR", "body": "It looks like you need to rebase in order to get the ci.yaml to gel with the latest CI recipes and then hopefully final goldens will be generated.", "createdAt": "2022-04-22T21:54:20Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [{"content": "THUMBS_UP", "users": {"totalCount": 1}}], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1106916349"}, {"id": "IC_kwDOAeUeuM5B_Iy-", "author": {"login": "flutter-dashboard"}, "authorAssociation": "NONE", "body": "Golden file changes are available for triage from new commit, Click [here to view](https://flutter-gold.skia.org/cl/github/101036).\n\n\n\nFor more guidance, visit [Writing a golden file test for `package:flutter`](https://github.com/flutter/flutter/wiki/Writing-a-golden-file-test-for-package:flutter).\n\n__Reviewers__: Read the [Tree Hygiene page](https://github.com/flutter/flutter/wiki/Tree-hygiene#how-to-review-code) and make sure this patch meets those guidelines before LGTMing.\n\n_Changes reported for pull request #101036 at sha 692b2715bd2b0cc9b076228b007c7506cc7d25e6_\n\n", "createdAt": "2022-04-23T00:25:28Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1107070142"}, {"id": "IC_kwDOAeUeuM5B_I5Z", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "Now seems better", "createdAt": "2022-04-23T00:27:08Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1107070553"}, {"id": "IC_kwDOAeUeuM5CkHfp", "author": {"login": "darrenaustin"}, "authorAssociation": "CONTRIBUTOR", "body": "Where the goldens for this approved? It looks like this is breaking the build:\r\n\r\nhttps://logs.chromium.org/logs/flutter/buildbucket/cr-buildbucket/8815144942697521329/+/u/run_test.dart_for_framework_tests_shard_and_subshard_widgets/test_stdout\r\n\r\n```\r\nThe following _Exception was thrown while running async test code:\r\nException: Skia Gold received an unapproved image in post-submit\r\ntesting. Golden file images in flutter/flutter are triaged\r\nin pre-submit during code review for the given PR.\r\n\r\nVisit https://flutter-gold.skia.org// to view and approve\r\nthe image(s), or revert the associated change. For more\r\ninformation, visit the wiki:\r\nhttps://github.com/flutter/flutter/wiki/Writing-a-golden-file-test-for-package:flutter\r\n\r\nDebug information for Gold:\r\nstdout: Given image with hash 94028cfacbe41a55af47edcddeff6540 for test widgets.image_filter_erode\r\nUntriaged or negative image:\r\nhttps://flutter-gold.skia.org/detail?test=widgets.image_filter_erode&digest=94028cfacbe41a55af47edcddeff6540\r\n\r\n\r\nstderr: Test: widgets.image_filter_erode FAIL\r\n\r\nWhen the exception was thrown, this was the stack:\r\n#0      SkiaGoldClient.imgtestAdd (package:flutter_goldens_client/skia_client.dart:216:7)\r\n<asynchronous suspension>\r\n<asynchronous suspension>\r\n(elided one frame from package:stack_trace)\r\n```\r\n\r\nCan we just approve the new goldens? If not I will need to revert this to get the tree green again.\r\n", "createdAt": "2022-05-03T23:41:44Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1116764137"}, {"id": "IC_kwDOAeUeuM5CkZY5", "author": {"login": "fzyzcjy"}, "authorAssociation": "CONTRIBUTOR", "body": "I do not have permission to approve the goldens, but seems that @flar has said that the goldens are ok, and he may have permission to approve", "createdAt": "2022-05-04T00:46:54Z", "includesCreatedEdit": true, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1116837433"}, {"id": "IC_kwDOAeUeuM5CkcWe", "author": {"login": "darrenaustin"}, "authorAssociation": "CONTRIBUTOR", "body": "It looks like it has been resolved and the tree is green again, so it's all good now.", "createdAt": "2022-05-04T01:20:57Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [{"content": "LAUGH", "users": {"totalCount": 1}}], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1116849566"}, {"id": "IC_kwDOAeUeuM5Ck9Y4", "author": {"login": "flar"}, "authorAssociation": "CONTRIBUTOR", "body": "I did approve the goldens, so I'm not sure what happened.", "createdAt": "2022-05-04T06:55:33Z", "includesCreatedEdit": false, "isMinimized": false, "minimizedReason": "", "reactionGroups": [], "url": "https://github.com/flutter/flutter/pull/101036#issuecomment-1116984888"}], "createdAt": "2022-03-30T10:48:14Z", "title": "(Test-only) Add tests for new `ImageFilter.dilate`/`ImageFilter.erode` in flutter engine"}}