{"source": "discord", "metadata": {"channel_id": "608021234516754444", "after": "1019348859601825852", "before": "1021814222688104548"}, "content": {"guild": {"id": "608014603317936148", "name": "flutter", "iconUrl": "https://cdn.discordapp.com/icons/608014603317936148/0ccc662ed5e2e6df807f4d3cde7018e8.png"}, "channel": {"id": "608021234516754444", "type": "GuildTextChat", "categoryId": "818574120342126622", "category": "FOR CONTRIBUTORS", "name": "hackers-framework-\ud83d\udd29", "topic": "For people working on RenderObjects, Elements, and other core parts of the Flutter framework."}, "dateRange": {"after": "2022-09-13T20:48:26.715+00:00", "before": "2022-09-20T16:04:55.079+00:00"}, "messages": [{"id": "1021783497112821861", "type": "Default", "timestamp": "2022-09-20T14:02:49.531+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "Hi, I have proposed an approach for 60fps smooth animation no matter how heavy widget tree build and layout is, without paying extra cost (such as redundant re-layout). https://github.com/flutter/flutter/issues/101227#issuecomment-1252379787", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [{"title": "(Willing to contribute PRs) Let Flutter run animations at 60fps eve...", "url": "https://github.com/flutter/flutter/issues/101227", "timestamp": null, "description": "Below (folded) are the initial proposal. However, I have realized the initial proposal has many drawbacks, and have raised new proposals. For example, the dual isolate (click to view that comment)....", "color": "#1E2327", "thumbnail": {"url": "https://images-ext-2.discordapp.net/external/2REN94kFoxapnNq3_kK9qw__rX2jd3gxzgYMkEkwjCQ/https/opengraph.githubassets.com/a80b5039ccc02cbc2272eee6fdbb4d3266c5269b616a22e1065ed7789e6bee1a/flutter/flutter/issues/101227", "width": 1200, "height": 600}, "images": [], "fields": []}], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021783945697837066", "type": "Default", "timestamp": "2022-09-20T14:04:36.482+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "@Hixie @dnfield (since @dnfield mentioned that layout suspending has been discussed between them; this one does suspend layout and render first)", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": [{"id": "169184957850189824", "name": "Hixie", "discriminator": "8080", "nickname": "Hixie", "isBot": false}, {"id": "612134153986768929", "name": "dnfield", "discriminator": "1305", "nickname": "dnfield", "isBot": false}]}, {"id": "1021784169891758091", "type": "Default", "timestamp": "2022-09-20T14:05:29.934+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "I am planning to start working on a prototype ~9hr later, but want to hear some hints from you experts, since I have not quite hacked the engine before", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021786735652376626", "type": "Default", "timestamp": "2022-09-20T14:15:41.659+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "I'm curious about how preemtRaster would modify the layer tree and how it would know where to resume. Those are the more difficult bits.", "author": {"id": "612134153986768929", "name": "dnfield", "discriminator": "1305", "nickname": "dnfield", "color": "#0175C2", "isBot": false, "avatarUrl": "https://cdn.discordapp.com/embed/avatars/0.png"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021788915583156284", "type": "Default", "timestamp": "2022-09-20T14:24:21.395+00:00", "timestampEdited": "2022-09-20T14:29:07.926+00:00", "callEndedTimestamp": null, "isPinned": false, "content": "Let's say, for simplicity as a demo, just modify a layer directly via lowest level api. - But we can definitely wrap it to some higher level. And with future thinking maybe we can also do something with existing widget framework.", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021789054594977842", "type": "Default", "timestamp": "2022-09-20T14:24:54.538+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "how it would know where to resume: Just call function and it returns! Example:", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021789201718579314", "type": "Default", "timestamp": "2022-09-20T14:25:29.615+00:00", "timestampEdited": "2022-09-20T14:26:02.936+00:00", "callEndedTimestamp": null, "isPinned": false, "content": "```dart\nclass RenderObject {\n  void layout() {\n    if (time_is_nearly_out) preemptRaster();\n    normal_layout_things;\n  }\n}\n\nvoid preemptRaster() {\n  modify_layer_tree_for_animation();\n  FlutterView.render(the_layer_tree);\n}\n```", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021789403288436778", "type": "Default", "timestamp": "2022-09-20T14:26:17.673+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "@dnfield", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": [{"id": "612134153986768929", "name": "dnfield", "discriminator": "1305", "nickname": "dnfield", "isBot": false}]}, {"id": "1021790802122375220", "type": "Default", "timestamp": "2022-09-20T14:31:51.181+00:00", "timestampEdited": "2022-09-20T14:32:10.332+00:00", "callEndedTimestamp": null, "isPinned": false, "content": "A question: Take `RenderOpacity` for example, and suppose we want that in preemptRaster. Currently it is: \n```\nlayer = context.pushOpacity(offset, _alpha, super.paint, oldLayer: layer as OpacityLayer?);\n\n// definition\n  OpacityLayer pushOpacity(Offset offset, int alpha, PaintingContextCallback painter, { OpacityLayer? oldLayer }) {\n    final OpacityLayer layer = oldLayer ?? OpacityLayer();\n    layer\n      ..alpha = alpha\n      ..offset = offset;\n    pushLayer(layer, painter, Offset.zero);\n    return layer;\n  }\n```\nSo, my naive thought of directly manipulating it:\n```\nvoid directlyManipulateOpacityInPreemptRaster() {\n  final OpacityLayer layer = layer_tree.children.where(...); // find opacity layer\n  layer.alpha = some_new_value_for_animation;\n}\n```\nIf I call merely this, without all those PictureRecorder/create-new-layer etc, will it be acceptable?", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021792183105355846", "type": "Default", "timestamp": "2022-09-20T14:37:20.433+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "What happens if a render object doesn't implement preemptRaster?", "author": {"id": "612134153986768929", "name": "dnfield", "discriminator": "1305", "nickname": "dnfield", "color": "#0175C2", "isBot": false, "avatarUrl": "https://cdn.discordapp.com/embed/avatars/0.png"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021792880861384764", "type": "Default", "timestamp": "2022-09-20T14:40:06.791+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "Just put it into `RenderObject.layout`", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021793050411933706", "type": "Default", "timestamp": "2022-09-20T14:40:47.215+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "e.g. add `if (time_is_nearly_out) preemptRaster();` as 1st line of RenderObject.layout. (Surely we may optimize it to be faster, but idea is same)", "author": {"id": "742298142774525963", "name": "fzyzcjy", "discriminator": "1693", "nickname": "fzyzcjy", "color": null, "isBot": false, "avatarUrl": "https://cdn.discordapp.com/avatars/742298142774525963/8ef0815374b5ef1e07e4af8132ffcaed.png?size=512"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021807196272603156", "type": "Default", "timestamp": "2022-09-20T15:36:59.851+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "What happens if devs write something slow into `preemptRaster`? \ud83d\ude42", "author": {"id": "612134153986768929", "name": "dnfield", "discriminator": "1305", "nickname": "dnfield", "color": "#0175C2", "isBot": false, "avatarUrl": "https://cdn.discordapp.com/embed/avatars/0.png"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}, {"id": "1021807402510716970", "type": "Default", "timestamp": "2022-09-20T15:37:49.022+00:00", "timestampEdited": null, "callEndedTimestamp": null, "isPinned": false, "content": "I'm curious about this, maybe it'd help to see a little bit more detail around implemenation. Perhaps write up a doc?", "author": {"id": "612134153986768929", "name": "dnfield", "discriminator": "1305", "nickname": "dnfield", "color": "#0175C2", "isBot": false, "avatarUrl": "https://cdn.discordapp.com/embed/avatars/0.png"}, "attachments": [], "embeds": [], "stickers": [], "reactions": [], "mentions": []}], "messageCount": 14}}